<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√≥digo Grabado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para el men√∫ desplegable */
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        /* Eliminado: Estilos para el toggle de Dark Mode */
    </style>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, getDocs, setDoc, getDoc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// Configuraci√≥n de Firebase (Se mantiene la configuraci√≥n original del usuario)
        const firebaseConfig = {
            apiKey: "AIzaSyCeD4TAPK2GuW01J5WQl7vJjmJWC671f-Y",
            authDomain: "codigograbado.firebaseapp.com",
            projectId: "codigograbado",
            storageBucket: "codigograbado.firebasestorage.app",
            messagingSenderId: "346430888474",
            appId: "1:346430888474:web:cbaa641fbf4fc62bca4fa3",
 
            measurementId: "G-626THBS8CJ"
        };
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId, loggedInUser = null;
        let functionsList = [];
        let editingId = null;
        let confirmActionCallback = null;
        
        let isSyntaxValid = false;
// SE ELIMINAN LAS CREDENCIALES CODIFICADAS DEL SUPER ADMIN
        const SUPER_ADMIN_KEY = 'DT10VazC;#9i';
// Rutas de Firestore
        const DB_ROOT = `/artifacts/public/data/aTvZxvxzBtCnCNlURVrQ`;
        const FUNCTIONS_PATH = `${DB_ROOT}/sql_functions`;
const ADMINS_PATH = `${DB_ROOT}/admins`;
        const LOGS_PATH = `${DB_ROOT}/logs`;
        const NOTIFICATIONS_PATH = `${DB_ROOT}/notifications`;
// ************************************************************
        // ********* FUNCI√ìN DE MANEJO DE TEMAS (ELIMINADA) *******
        // ************************************************************
        const initializeTheme = () => {
             // Ya no hace nada, se elimin√≥ la l√≥gica de dark mode.
};
        const applyTailwindClasses = (isDark) => {
             // Ya no hace nada.
};
        
        const toggleDarkMode = () => {
             // Ya no hace nada.
        };
        // ************************************************************


        // --- Funciones del Modal de Confirmaci√≥n ---
        const showConfirmModal = (message, onConfirm) => {
            document.getElementById('confirmModalMessage').textContent = message;
document.getElementById('confirmModal').classList.remove('hidden');
            document.getElementById('confirmModal').classList.add('flex');
            confirmActionCallback = onConfirm;
        };

        const hideConfirmModal = () => {
            document.getElementById('confirmModal').classList.add('hidden');
document.getElementById('confirmModal').classList.remove('flex');
            confirmActionCallback = null;
        };

        const handleConfirm = (isConfirmed) => {
            if (isConfirmed && confirmActionCallback) {
                confirmActionCallback();
}
            hideConfirmModal();
        };
// --- Fin Funciones del Modal de Confirmaci√≥n ---


        // Funci√≥n para inicializar Firebase
        const initFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
db = getFirestore(app);
                auth = getAuth(app); 
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
} else {
                    await signInAnonymously(auth);
}
                
                userId = auth.currentUser.uid;
document.getElementById('userIdDisplay').textContent = `Tu ID de usuario: ${userId}`;
                
                console.log("Firebase inicializado y autenticaci√≥n exitosa.");
                fetchFunctions();
} catch (error) {
                console.error("Error al inicializar Firebase o autenticar:", error);
showMessage("Error: No se pudo conectar a la base de datos.", 'error');
            }
        };
const showMessage = (message, type = 'info') => {
            const statusMessage = document.getElementById('statusMessage');
let targetElement = statusMessage; 
            if (!targetElement) {
                targetElement = document.getElementById('recommendationResults');
}

            if (!targetElement) return;
targetElement.innerHTML = `<div class="mt-4 text-center p-3 rounded-lg font-medium" id="tempStatusMessage">${message}</div>`;
            const tempStatusMessage = document.getElementById('tempStatusMessage');

            tempStatusMessage.className = 'mt-4 text-center p-3 rounded-lg font-medium';
if (type === 'error') {
                tempStatusMessage.classList.add('bg-rose-200', 'text-rose-800');
} else if (type === 'success') {
                tempStatusMessage.classList.add('bg-emerald-200', 'text-emerald-800');
} else {
                // Tema Blueberry Oscuro: Info messages are light blue
                tempStatusMessage.classList.add('bg-blue-200', 'text-blue-800');
}

            if (targetElement !== statusMessage) {
                setTimeout(() => {
                    targetElement.innerHTML = '';
                }, 5000);
}
        };

        const fetchFunctions = () => {
            if (!db) return;
const q = collection(db, FUNCTIONS_PATH);
            onSnapshot(q, (snapshot) => {
                functionsList = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
               
displayFunctions();
            }, (error) => {
                console.error("Error al obtener comandos:", error);
                showMessage("Error al cargar los comandos.", 'error');
            });
};

        const fetchNotifications = () => {
            console.log("Carga de notificaciones deshabilitada en la interfaz.");
return;
        };

        const addNotification = async (func) => { /* No hace nada, el log ya se crea en addOrUpdateFunction */ };
const deleteNotification = async (functionName) => { /* No hace nada, el log ya se crea en deleteFunction */ };
const displayNotifications = (notifications) => {
            const notificationsList = document.getElementById('notificationsList');
if (notificationsList) {
                notificationsList.innerHTML = '<p class="text-center text-gray-500 text-sm py-2">Esta funcionalidad est√° deshabilitada en la interfaz.\nLa actividad se registra en Firestore Logs.</p>';
}
        };
const displayFunctions = (functionsToDisplay = functionsList) => {
            const listElement = document.getElementById('functionsList');
const searchList = document.getElementById('searchFunctionsList');
            listElement.innerHTML = '';
            searchList.innerHTML = '';

            const isUserLoggedIn = loggedInUser !== null;
if (functionsToDisplay.length === 0) {
                listElement.innerHTML = '<p class="text-center text-gray-500">No se encontraron comandos.</p>';
}

            functionsToDisplay.forEach(func => {
                const funcItem = document.createElement('div');
                // Tema Blueberry Oscuro: Card background is light gray-700
                funcItem.className = 'p-4 rounded-lg shadow-md mb-4 bg-gray-700';
                
    
 
funcItem.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-100">${func.name}</h3>
                    <p class="text-sm text-gray-300 mb-2"><strong>Descripci√≥n:</strong> ${func.description}</p>
                    <div class="p-3 rounded-lg border border-gray-600 overflow-x-auto bg-gray-800">
         
 
<pre class="whitespace-pre-wrap font-mono text-gray-100"><code>${func.syntax}</code></pre>
                    </div>
                    <div class="mt-4 flex space-x-2 ${isUserLoggedIn ? '' : 'hidden'}">
                        <button class="edit-btn bg-sky-600 
hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg 
transition duration-200 text-sm" data-id="${func.id}">Editar</button>
                        <button class="delete-btn bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-sm" data-id="${func.id}">Eliminar</button>
                    </div>
                `;
listElement.appendChild(funcItem);

                if (isUserLoggedIn) {
                    funcItem.querySelector('.edit-btn').addEventListener('click', () => editFunction(func));
funcItem.querySelector('.delete-btn').addEventListener('click', () => deleteFunction(func.id));
                }

                const searchItem = document.createElement('li');
searchItem.className = 'hover:bg-blue-700 cursor-pointer p-2 rounded-md transition duration-150 text-gray-100'; // Tema Blueberry Oscuro: Blue hover
                searchItem.textContent = func.name;
searchItem.onclick = () => {
                    document.getElementById('descriptionSearch').value = func.description;
document.getElementById('descriptionSearch').focus();
                    showMessage(`Descripci√≥n del comando "${func.name}" cargada en el generador de consultas.`, 'info');
                };
                searchList.appendChild(searchItem);
            });
        };
const validateFunctionWithAI = async () => {
            const name = document.getElementById('funcName').value.trim();
const description = document.getElementById('funcDescription').value.trim();
            const syntax = document.getElementById('funcSyntax').value.trim();
            const validationMessageDiv = document.getElementById('validationMessage');
            const validateButton = document.getElementById('validateSyntaxButton');
if (!loggedInUser) {
                validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Debes iniciar sesi√≥n para pre-validar la sintaxis.</p>`;
return;
            }

            if (!name || !description || !syntax) {
                validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Completa los campos Nombre, Descripci√≥n y Sintaxis para validar.</p>`;
return;
            }

            validateButton.textContent = 'Validando...';
            validateButton.disabled = true;
validationMessageDiv.innerHTML = `<p class="mt-2 text-center p-3 rounded-lg font-medium bg-blue-200 text-blue-800">Analizando sintaxis con IA...</p>`;
// Tema Blueberry: Blue info
            isSyntaxValid = false;
const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q";
const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; 
            
            let prompt = `Eres un experto en SQL.
El usuario est√° intentando guardar un comando SQL.
1. **Comando/Concepto Intendado:** "${name}"
            2. **Descripci√≥n:** "${description}"
            3. **Sintaxis proporcionada:** "${syntax}"

            Eval√∫a si la 'Sintaxis proporcionada' es un comando SQL bien formado (DDL, DML, TCL, o una funci√≥n SQL) y que est√© razonablemente relacionado con el 'Comando/Concepto Intendado'.
- Si la Sintaxis es un comando SQL v√°lido, responde con: SI:VALIDA
            - Si la Sintaxis NO es un comando SQL v√°lido (ej. est√° incompleto o es err√≥neo), analiza la sintaxis y la descripci√≥n para sugerir el comando SQL que el usuario probablemente pretend√≠a usar.
Responde con: NO:Sugerencia de Comando: [Comando/Correcci√≥n sugerida]`;


            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: "Responde estrictamente con 'SI:VALIDA' o 'NO:Sugerencia de Comando: [COMANDO SUGERIDO/CORRECCI√ìN]'. No uses comillas ni explicaciones adicionales."
}] },
            };
            
            let attempts = 0;
const maxAttempts = 3;
            const initialDelay = 1000;

            const makeApiCall = async () => {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    
body: JSON.stringify(payload)
                });
if (response.status === 429 && attempts < maxAttempts - 1) {
                    throw new Error("Rate limit exceeded");
}
                return response;
            };
try {
                let response;
while (attempts < maxAttempts) {
                    try {
                        response = await makeApiCall();
break;
                    } catch (error) {
                        if (error.message === "Rate limit exceeded") {
                            const delay = initialDelay * Math.pow(2, attempts);
await new Promise(resolve => setTimeout(resolve, delay));
                            attempts++;
                        } else {
                            throw error;
}
                    }
                }
                
                const result = await response.json();
const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || '';
                
                const responseText = text.trim().toUpperCase();
if (responseText.startsWith('SI:VALIDA')) {
                    isSyntaxValid = true;
validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-emerald-800 bg-emerald-200 p-3 rounded-lg">¬°Validaci√≥n exitosa! La sintaxis es un comando SQL v√°lido. Puedes guardar.</p>`;
return { valid: true };
                } else if (responseText.startsWith('NO:SUGERENCIA DE COMANDO:')) {
                    const suggestion = responseText.replace('NO:SUGERENCIA DE COMANDO:', '').trim();
const userMessage = `Error de Sintaxis: Lo que ingresaste NO es un comando SQL v√°lido.
Sugerencia de la IA: **${suggestion}**.\nPor favor, ajusta la sintaxis y vuelve a validar.`;
validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">${userMessage}</p>`;
return { valid: false };
} else {
                    validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Error: La sintaxis no es v√°lida.\nInt√©ntalo de nuevo.</p>`;
return { valid: false };
                }
            } catch (error) {
                console.error("Error al validar con IA:", error);
validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Error de conexi√≥n: No se pudo validar con la IA.</p>`;
return { valid: false };
            } finally {
                validateButton.textContent = 'Pre-validar Sintaxis con IA ‚ú®';
validateButton.disabled = false;
            }
        };
// ************************************************************
        // ********* FUNCI√ìN PARA GENERAR CONSULTA SQL (CORREGIDA) *****
        // ************************************************************
        const generateSQLQuery = async () => {
            const description = document.getElementById('descriptionSearch').value.trim();
const button = document.getElementById('descriptionSearchButton');
            const resultsDiv = document.getElementById('recommendationResults');
            
            if (!description) {
                showMessage('Por favor, describe tu necesidad para generar la consulta.', 'error');
return;
            }

            button.textContent = 'Generando...';
            button.disabled = true;
resultsDiv.innerHTML = '';
            
resultsDiv.innerHTML = `<p class="mt-4 text-center p-3 rounded-lg font-medium bg-blue-200 text-blue-800">Generando consulta SQL...</p>`;
// Tema Blueberry: Blue info


            const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q";
// Tu API Key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
const prompt = `Eres un experto en SQL. Genera una consulta SQL (solo el c√≥digo, no expliques nada) basada en la siguiente descripci√≥n.
No incluyas comentarios o texto adicional. Descripci√≥n: "${description}".`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: "Genera exclusivamente c√≥digo SQL para bases de datos relacionales, sin ning√∫n texto, explicaci√≥n o comentarios."
}] },
            };
try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
            
    });
                
                if (!response.ok) {
                    throw new Error(`Error en la API: ${response.statusText}`);
}

                const result = await response.json();
const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || '';
                
                const sqlCode = text.replace(/```sql|```/g, '').trim();
// Tema Blueberry Oscuro: Use dark background for code block
resultsDiv.innerHTML = `
                    <h3 class="text-xl font-bold mt-4 mb-2 text-gray-100">Consulta Generada:</h3>
                    <div class="bg-gray-800 p-4 rounded-lg border border-blue-400 overflow-x-auto">
                        <pre class="whitespace-pre-wrap font-mono text-gray-100"><code>${sqlCode}</code></pre>
          
 </div>
                `;
showMessage('Consulta SQL generada con √©xito.', 'success');
                
            } catch (error) {
                console.error("Error al generar la consulta SQL:", error);
resultsDiv.innerHTML = `<p class="mt-4 text-center p-3 rounded-lg font-medium bg-rose-200 text-rose-800">Error al generar la consulta: ${error.message}. Intenta de nuevo.</p>`;
} finally {
                button.textContent = 'Generar Consulta SQL ‚ú®';
button.disabled = false;
            }
        };
// ************************************************************
// ********* FUNCI√ìN PARA A√ëADIR M√öLTIPLES COMANDOS CON IA *****
// ************************************************************
const bulkAddFunctionsWithAI = async (event) => {
    event.preventDefault();
const bulkInput = document.getElementById('bulkInput').value.trim();
    const resultDiv = document.getElementById('bulkResult');
    const button = document.getElementById('bulkAddButton');
if (!loggedInUser) {
        resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Debes iniciar sesi√≥n para usar la adici√≥n masiva.</p>`;
return;
    }

    if (!bulkInput) {
        resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Por favor, ingresa una lista de conceptos o consultas para procesar.</p>`;
return;
    }

    button.textContent = 'Procesando...';
    button.disabled = true;
resultDiv.innerHTML = `<p class="mt-4 text-center p-3 rounded-lg font-medium bg-blue-200 text-blue-800">Analizando y estructurando comandos con IA...</p>`;

    const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q";
const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; 

    let prompt = `Eres un asistente experto en SQL.
La entrada es una lista de comandos SQL, conceptos o descripciones.
Tu tarea es procesar esta lista y generar una respuesta estructurada en formato JSON, donde cada elemento tiene 'name', 'description' y 'syntax'.
Para cada elemento, aseg√∫rate de que 'syntax' contenga el comando SQL real y la 'description' sea una explicaci√≥n breve.
Ejemplo de formato de salida JSON:
    [{ "name": "SELECT", "description": "Recupera datos de una o m√°s tablas.", "syntax": "SELECT column1, column2 FROM table_name WHERE condition;"
}, { "name": "..." , "description": "...", "syntax": "..." }]

    Entrada a procesar: "${bulkInput}"`;
const payload = {
        contents: [{ parts: [{ text: prompt }] }],
        config: {
            responseMimeType: "application/json",
        },
    };
try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
const result = await response.json();
        const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text || '[]';
        const commands = JSON.parse(jsonText);
if (!Array.isArray(commands) || commands.length === 0) {
            resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Error: La IA no pudo generar una lista de comandos v√°lida.
Intenta con una lista m√°s clara.</p>`;
            return;
        }

        let addedCount = 0;
let failedCount = 0;

        for (const cmd of commands) {
            if (cmd.name && cmd.syntax) {
                await addDoc(collection(db, FUNCTIONS_PATH), {
                    name: cmd.name,
                    description: cmd.description || 'Sin descripci√≥n.',
           
          syntax: cmd.syntax,
                    createdAt: new Date()
                });
await addDoc(collection(db, LOGS_PATH), {
                    action: "bulk_added",
                    user: loggedInUser.username,
                    functionName: cmd.name,
                    timestamp: new Date()
            
     });
                addedCount++;
            } else {
                failedCount++;
}
        }

        resultDiv.innerHTML = `<p class="mt-4 text-center text-emerald-800 bg-emerald-200 p-3 rounded-lg">¬°Proceso Terminado!
Se agregaron ${addedCount} comandos con √©xito. Fallaron ${failedCount}.</p>`;
        document.getElementById('bulkInput').value = '';
} catch (error) {
        console.error("Error en la adici√≥n masiva con IA:", error);
resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Error de conexi√≥n o formato: No se pudo procesar la adici√≥n masiva.</p>`;
} finally {
        button.textContent = 'A√±adir Comandos Masivamente con IA üöÄ';
button.disabled = false;
    }
};

        
const addOrUpdateFunction = async (event) => {
            event.preventDefault();
const name = document.getElementById('funcName').value.trim();
            const description = document.getElementById('funcDescription').value.trim();
            const syntax = document.getElementById('funcSyntax').value.trim();
            const button = document.getElementById('addFunctionButton');
const originalButtonText = editingId ? 'Actualizar Comando' : 'Guardar Comando';
if (!loggedInUser) {
                showMessage('Debes iniciar sesi√≥n para realizar esta acci√≥n.', 'error');
return;
            }

            if (!name || !description || !syntax) {
                showMessage('Todos los campos son obligatorios.', 'error');
return;
            }
            
            if (!isSyntaxValid && !editingId) {
                document.getElementById('validationMessage').innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">¬°Atenci√≥n!\nLa sintaxis no ha sido pre-validada o la validaci√≥n fall√≥.
Usa el bot√≥n "Pre-validar" antes de guardar.</p>`;
                return;
}

            button.textContent = 'Guardando...';
button.disabled = true;
try {
                if (editingId) {
                    await updateDoc(doc(db, FUNCTIONS_PATH, editingId), {
                        name,
                        description,
      
    
                       syntax,
                    });
// CREACI√ìN DE LOG
                    await addDoc(collection(db, LOGS_PATH), {
                        action: "edited",
                        user: loggedInUser.username,
                        
functionName: name,
                        timestamp: new Date()
                    });
showMessage(`Comando actualizado con √©xito.`, 'success');
                    editingId = null;
                    document.getElementById('addFunctionButton').textContent = 'Guardar Comando';
} else {
                    await addDoc(collection(db, FUNCTIONS_PATH), {
                        name,
                        description,
                        syntax,
   
                      createdAt: new Date()
                    });
// CREACI√ìN DE LOG
                    await addDoc(collection(db, LOGS_PATH), {
                        action: "added",
                        user: loggedInUser.username,
                        
functionName: name,
                        timestamp: new Date()
                    });
showMessage(`Comando agregado con √©xito.`, 'success');
                }
                document.getElementById('addFunctionForm').reset();
document.getElementById('validationMessage').innerHTML = ''; 
                isSyntaxValid = false; 
            } catch (e) {
                console.error("Error al agregar/actualizar documento: ", e);
showMessage("Error al guardar el comando. Verifica la consola de Firebase.", 'error');
} finally {
                button.textContent = originalButtonText;
button.disabled = false;
            }
        };
const editFunction = (func) => {
            editingId = func.id;
document.getElementById('funcName').value = func.name;
            document.getElementById('funcDescription').value = func.description;
            document.getElementById('funcSyntax').value = func.syntax;
            document.getElementById('addFunctionButton').textContent = 'Actualizar Comando';
            document.getElementById('addFunctionSection').scrollIntoView({ behavior: 'smooth' });
document.getElementById('validationMessage').innerHTML = '<p class="mt-2 text-center text-blue-800 bg-blue-200 p-3 rounded-lg">Modo Edici√≥n: La validaci√≥n previa se omite al guardar.</p>';
// Tema Blueberry: Blue info
            isSyntaxValid = true;
        };
const deleteFunction = async (id) => {
            if (!loggedInUser) {
                showMessage('Debes iniciar sesi√≥n para realizar esta acci√≥n.', 'error');
return;
            }
            
            showConfirmModal('¬øEst√°s seguro de que quieres eliminar este comando? Esta acci√≥n no se puede deshacer.', async () => {
                try {
                    const docRef = doc(db, FUNCTIONS_PATH, id);
                
 
     const funcSnap = await getDoc(docRef);
                    if (funcSnap.exists()) {
                        await deleteDoc(docRef);
                        
                    
  
    // CREACI√ìN DE LOG
                        await addDoc(collection(db, LOGS_PATH), {
                            action: "deleted",
                            user: loggedInUser.username,
       
  
                    functionName: funcSnap.data().name,
                            timestamp: new Date()
                        });

                       
  showMessage('Comando eliminado \ncon √©xito.', 'success');
                    }
                } catch (e) {
                    console.error("Error al eliminar documento: ", e);
showMessage("Error al eliminar el comando.", 'error');
}
            });
        };
const createAdmin = async (event) => {
            event.preventDefault();
const newAdminEmail = document.getElementById('newAdminEmail').value.trim();
            const newAdminPassword = document.getElementById('newAdminPassword').value;
            const newAdminUsername = document.getElementById('newAdminUsername').value.trim();
            const secretKey = document.getElementById('secretKey').value;
            const adminMessage = document.getElementById('adminMessage');
adminMessage.textContent = '';
            adminMessage.className = 'mt-4 text-center text-sm';
            
            const isPromotingExistingUser = secretKey === SUPER_ADMIN_KEY;
if (!newAdminEmail || !newAdminPassword || !newAdminUsername) {
                adminMessage.textContent = 'Todos los campos son obligatorios.';
adminMessage.classList.add('text-rose-500');
                return;
            }
            
            let uid = null;
try {
                const userCredential = await createUserWithEmailAndPassword(auth, newAdminEmail, newAdminPassword);
uid = userCredential.user.uid;
            } catch (e) {
                if (e.code === 'auth/email-already-in-use') {
                    if (isPromotingExistingUser) {
                        try {
                           
  const userCredential = await signInWithEmailAndPassword(auth, newAdminEmail, newAdminPassword);
                            uid = userCredential.user.uid;
                            await signOut(auth);
adminMessage.textContent = 'Advertencia: El email ya exist√≠a.\nSe asignar√°n permisos de administrador.';
                            adminMessage.classList.add('text-yellow-500');
} catch (signInError) {
                             let displayError = 'Error: El email ya est√° registrado, pero la contrase√±a no coincide.\nNo se puede obtener el UID para asignar permisos.';
adminMessage.textContent = displayError;
                             adminMessage.classList.add('text-rose-500');
                             return;
}
                    } else {
                        adminMessage.textContent = 'Error: El email ya est√° registrado.\nPara promocionar a un usuario existente, ingrese la clave secreta.';
adminMessage.classList.add('text-rose-500');
                        return;
}
                } else if (e.code === 'auth/weak-password') {
                    adminMessage.textContent = 'Error: La contrase√±a debe tener al menos 6 caracteres.';
adminMessage.classList.add('text-rose-500');
                    return;
                } else {
                    console.error("Error al crear usuario Auth:", e);
adminMessage.textContent = `Error (${e.code || 'unknown-error'}): No se pudo crear la cuenta de usuario.`;
                    adminMessage.classList.add('text-rose-500');
                    return;
}
            }
            
            if (!uid) { return;
} 

            try {
                await setDoc(doc(db, ADMINS_PATH, uid), {
                    uid: uid,
                    username: newAdminUsername,
                    email: newAdminEmail,
   
                  isAdmin: true, 
                    lastLogin: null
                }, { merge: true });
if (!adminMessage.classList.contains('text-yellow-500')) {
                    adminMessage.textContent = `Administrador ${newAdminUsername} creado con √©xito.\nAhora puede iniciar sesi√≥n con su email y contrase√±a.`;
adminMessage.classList.add('text-emerald-500');
}
                document.getElementById('createAdminForm').reset();
} catch (e) {
                console.error("Error al registrar administrador en Firestore:", e);
adminMessage.textContent = 'Error: Se cre√≥ la cuenta de Auth, pero fall√≥ el registro de permisos en Firestore.';
                adminMessage.classList.add('text-rose-500');
}
        };

        const logout = async () => {
            try {
                if (auth.currentUser) {
                    await signOut(auth);
}
                
                loggedInUser = null;
// Ocultar secciones de administraci√≥n
                document.getElementById('addFunctionSection').classList.add('hidden');
document.getElementById('fixErrorSection').classList.add('hidden');
                document.getElementById('adminManagementSection').classList.add('hidden');
                document.getElementById('notificationsSection').classList.add('hidden');
                document.getElementById('bulkAddSection').classList.add('hidden'); // Ocultar secci√≥n masiva
                
                // Mostrar/Ocultar elementos del men√∫
                document.getElementById('adminDropdownLogin').classList.remove('hidden');
document.getElementById('adminDropdownLogout').classList.add('hidden');
                document.getElementById('adminDropdownManagement').classList.add('hidden');
                document.getElementById('welcomeMessage').classList.add('hidden');


                await signInAnonymously(auth);
                userId = auth.currentUser.uid;
                document.getElementById('userIdDisplay').textContent = `Tu ID de usuario: ${userId}`;

                displayFunctions(); 

                showMessage('Sesi√≥n cerrada correctamente.', 'info');
} catch (error) {
                console.error("Error al cerrar sesi√≥n o al re-autenticar an√≥nimamente:", error);
showMessage('Error al cerrar sesi√≥n.', 'error');
            }
        };
const login = async (event) => {
            event.preventDefault();
const loginEmail = document.getElementById('loginEmail').value.trim();
            const loginPassword = document.getElementById('loginPassword').value;
            const loginMessage = document.getElementById('loginMessage');
            
            loginMessage.textContent = '';
            loggedInUser = null;
let userFound = false;
            let uid = null;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, loginEmail, loginPassword);
const user = userCredential.user;
                uid = user.uid;

                loggedInUser = { 
                    uid: uid,
                    username: loginEmail.split('@')[0], 
                    isAdmin: true, 
                    lastLogin: null 
   
             };
                userFound = true;
try {
                    const docRef = doc(db, ADMINS_PATH, uid);
const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        loggedInUser.lastLogin = docSnap.data().lastLogin;
loggedInUser.username = docSnap.data().username || loggedInUser.username;
                    }
                } catch (e) {
                    console.warn("No se pudo obtener el documento de admin para la verificaci√≥n de logs.", e);
}

            } catch (e) {
                console.error("Error de autenticaci√≥n:", e);
const errorCode = e.code || '';
                
                if (errorCode === 'auth/invalid-credential' || errorCode === 'auth/user-not-found' || errorCode === 'auth/wrong-password') {
                    loginMessage.textContent = 'Credenciales incorrectas.';
} else {
                    loginMessage.textContent = 'Error de autenticaci√≥n.\nVerifica tus datos.';
}
                loginMessage.classList.add('text-rose-500');
return;
}


            if (userFound) {
                closeAdminModal();
// Cierra el modal al iniciar sesi√≥n
                
                // Mostrar botones de administraci√≥n en el men√∫
                document.getElementById('adminDropdownLogin').classList.add('hidden');
document.getElementById('adminDropdownLogout').classList.remove('hidden');
                document.getElementById('adminDropdownManagement').classList.remove('hidden');

                // **********************************************
                // ********* CORRECCI√ìN APLICADA AQU√ç ***********
                // **********************************************
                document.getElementById('addFunctionSection').classList.remove('hidden');
                document.getElementById('fixErrorSection').classList.remove('hidden');
                // document.getElementById('adminManagementSection').classList.remove('hidden'); // L√çNEA DE ERROR ELIMINADA
                document.getElementById('bulkAddSection').classList.remove('hidden'); // Mostrar secci√≥n masiva

                displayFunctions();
// Refresca botones de editar/eliminar

                const userDataRef = doc(db, ADMINS_PATH, loggedInUser.uid);
await sendWelcomeMessage(loggedInUser.lastLogin, loggedInUser.username);
                
                await setDoc(userDataRef, { 
                    lastLogin: new Date(),
                    username: loggedInUser.username,
                    uid: loggedInUser.uid,
                    isAdmin: true 
        
                }, { merge: true });
showMessage(`¬°Bienvenido, ${loggedInUser.username}! Has iniciado sesi√≥n con √©xito.`, 'success');
                document.getElementById('welcomeMessage').classList.remove('hidden');
            }
        };
const sendWelcomeMessage = async (lastLogin, username) => {
            const welcomeMessageDiv = document.getElementById('welcomeMessage');
let actionsSummary = '';
            
            if (lastLogin) {
                const logsRef = collection(db, LOGS_PATH);
const q = query(logsRef, where("user", "==", username));
                try {
                    const querySnapshot = await getDocs(q);
const recentActions = [];
                    querySnapshot.forEach(doc => {
                        const log = doc.data();
                        if (log.timestamp.toDate() > lastLogin.toDate()) {
                            recentActions.push(log);
           
              }
                    });
if (recentActions.length > 0) {
                        const added = recentActions.filter(a => a.action === 'added').map(a => a.functionName).join(', ');
const edited = recentActions.filter(a => a.action === 'edited').map(a => a.functionName).join(', ');
const deleted = recentActions.filter(a => a.action === 'deleted').map(a => a.functionName).join(', ');
actionsSummary = `Resumen de tu actividad: ${added.length > 0 ? `agregaste: ${added}. ` : ''}${edited.length > 0 ?
`editaste: ${edited}.\n` : ''}${deleted.length > 0 ? `eliminaste: ${deleted}. ` : ''}`;
}
                } catch (error) {
                    console.error("Error al obtener logs:", error);
}
            }
            
            const diffMs = lastLogin ?
new Date() - lastLogin.toDate() : null;
            const diffDays = diffMs ?
Math.floor(diffMs / (1000 * 60 * 60 * 24)) : null;
            const timeAgo = diffDays !== null ?
`${diffDays} d√≠a(s)` : 'primera vez';

            welcomeMessageDiv.textContent = 'Generando mensaje de bienvenida...';

            const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
const prompt = `Genera un mensaje de bienvenida para un administrador de una base de datos de comandos de SQL.
El nombre del usuario es "${username}". Su √∫ltima sesi√≥n fue hace "${timeAgo}".
El mensaje debe ser breve, motivador y debe recordarle revisar el panel de logs.
Incluye el siguiente resumen de su actividad: "${actionsSummary}". Termina el mensaje con la frase "¬°Buen c√≥digo!".`;
const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: "Genera un mensaje de bienvenida amigable y motivador."
}] },
            };
try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
            
    });
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || `¬°Bienvenido de nuevo, ${username}!`;
welcomeMessageDiv.textContent = text;
            } catch (error) {
                console.error("Error al generar el mensaje de bienvenida:", error);
welcomeMessageDiv.textContent = `¬°Bienvenido de nuevo, ${username}! Te recordamos que revises el panel de logs. ¬°Buen c√≥digo!`;
}
        };

        const fixSyntaxWithAI = async () => {
            const syntax = document.getElementById('errorInput').value.trim();
const correctionKey = document.getElementById('correctionKey').value.trim();
            const resultDiv = document.getElementById('correctionResult');
            const button = document.getElementById('fixButton');
if (!syntax) {
                resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Por favor, ingresa el c√≥digo SQL a corregir.</p>`;
return;
            }

            if (correctionKey !== SUPER_ADMIN_KEY) {
                resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Clave de Promoci√≥n incorrecta.\nDebes ser administrador para usar esta funci√≥n.</p>`;
return;
            }

            button.textContent = 'Corrigiendo...';
button.disabled = true;
resultDiv.innerHTML = `<p class="mt-4 text-center p-3 rounded-lg font-medium bg-blue-200 text-blue-800">Analizando y corrigiendo sintaxis con IA...</p>`;
// Tema Blueberry: Blue info
const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
const prompt = `Eres un experto en optimizaci√≥n y correcci√≥n de c√≥digo SQL.
Corrige cualquier error de sintaxis en el siguiente c√≥digo y, si es posible, ofr√©ceme una versi√≥n optimizada.
Devuelve S√ìLO el c√≥digo SQL final corregido y optimizado. No uses comentarios ni ninguna explicaci√≥n. C√≥digo SQL: ${syntax}`;
const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: "Corrige y optimiza el c√≥digo SQL, devolviendo exclusivamente la consulta SQL resultante."
}] },
            };
try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
            
    });

                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text ||
'No se pudo generar una correcci√≥n.';

                const correctedCode = text.replace(/```sql|```/g, '').trim();
resultDiv.innerHTML = `
                    <h3 class="text-xl font-bold mt-4 mb-2 text-gray-100">C√≥digo Corregido/Optimizado:</h3>
                    <div class="bg-emerald-100 p-4 rounded-lg border border-emerald-400 overflow-x-auto">
                        <pre class="whitespace-pre-wrap font-mono text-emerald-800"><code>${correctedCode}</code></pre>
                   
 </div>
                `;
} catch (error) {
                console.error("Error al corregir con IA:", error);
resultDiv.innerHTML = `<p class="mt-4 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">Error al conectar con la IA para la correcci√≥n.</p>`;
} finally {
                button.textContent = 'Corregir Sintaxis ‚ú®';
button.disabled = false;
            }
        };
const searchFunctions = (event) => {
            const searchTerm = event.target.value.toLowerCase();
const filteredFunctions = functionsList.filter(func => 
                func.name.toLowerCase().includes(searchTerm) || 
                func.description.toLowerCase().includes(searchTerm) || 
                func.syntax.toLowerCase().includes(searchTerm)
            );
displayFunctions(filteredFunctions);
        };

        // ************************************************************
        // ********* FUNCIONES PARA EL MODAL DE ADMINISTRACI√ìN *********
        // ************************************************************
        const showAdminLogin = () => {
            document.getElementById('adminLoginModal').classList.remove('hidden');
document.getElementById('adminLoginModal').classList.add('flex');
            document.getElementById('adminLoginContainer').classList.remove('hidden');
            document.getElementById('createAdminContainer').classList.add('hidden');
        };

        const showAdminManagement = () => {
             document.getElementById('adminLoginModal').classList.remove('hidden');
document.getElementById('adminLoginModal').classList.add('flex');
             document.getElementById('adminLoginContainer').classList.add('hidden');
             document.getElementById('createAdminContainer').classList.remove('hidden');
        };

        const closeAdminModal = () => {
            document.getElementById('adminLoginModal').classList.add('hidden');
document.getElementById('adminLoginModal').classList.remove('flex');
        };


        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            initFirebase();
            
            // ************************************************************
            // ********* EVENT LISTENERS CORREGIDOS *************************
            // ************************************************************
            document.getElementById('showLoginButton').addEventListener('click', showAdminLogin);
   
             document.getElementById('logoutButton').addEventListener('click', logout);
            document.getElementById('showAdminManagementButton').addEventListener('click', showAdminManagement);
            document.getElementById('closeAdminModalButton').addEventListener('click', closeAdminModal);
            // document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode); <-- REMOVED

            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('addFunctionForm').addEventListener('submit', addOrUpdateFunction);
document.getElementById('bulkAddForm').addEventListener('submit', bulkAddFunctionsWithAI); // A√ëADIDO: Bulk Add Listener
document.getElementById('validateSyntaxButton').addEventListener('click', validateFunctionWithAI);
            document.getElementById('descriptionSearchButton').addEventListener('click', generateSQLQuery);
// <-- Bot√≥n Generador
            document.getElementById('fixButton').addEventListener('click', fixSyntaxWithAI);
document.getElementById('createAdminForm').addEventListener('submit', createAdmin);
document.getElementById('functionSearchInput').addEventListener('input', searchFunctions);
            document.getElementById('confirmBtn').addEventListener('click', () => handleConfirm(true));
            document.getElementById('cancelBtn').addEventListener('click', () => handleConfirm(false));
const resetValidation = () => {
                isSyntaxValid = false;
document.getElementById('validationMessage').innerHTML = '';
                document.getElementById('statusMessage').innerHTML = '';
            };
            document.getElementById('funcName').addEventListener('input', resetValidation);
            document.getElementById('funcDescription').addEventListener('input', resetValidation);
            document.getElementById('funcSyntax').addEventListener('input', resetValidation);
        });
</script>
</head>
<body class="bg-gray-900 font-sans leading-normal tracking-normal text-gray-100">

    <header class="bg-blue-700 shadow-xl sticky top-0 z-10">
        <div class="container mx-auto px-4 md:px-8 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-extrabold text-white">C√≥digo Grabado</h1>
            
            <div class="flex items-center space-x-4">
                
     
      
                <div class="dropdown inline-block relative">
                    <button class="bg-blue-600 text-white font-semibold py-2 px-4 rounded inline-flex items-center hover:bg-blue-700 transition duration-200">
                        <span class="mr-1">Admin</span>
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 
20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
 
                    </button>
                    <ul class="dropdown-menu absolute hidden text-gray-100 pt-1 right-0 z-20 w-64 shadow-xl border border-gray-600 bg-gray-800 rounded-lg overflow-hidden transition-colors duration-300">
                        
          
          
      <li id="adminDropdownLogin">
                            <a id="showLoginButton" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 block whitespace-no-wrap cursor-pointer text-sm">
                                Iniciar Sesi√≥n
             
          </a>
                        </li>

                        <li id="adminDropdownManagement" class="hidden">
                            <a id="showAdminManagementButton" class="bg-gray-700 hover:bg-gray-600 text-gray-100 py-2 
px-4 block whitespace-no-wrap cursor-pointer text-sm font-medium transition-colors duration-300">
  
                                Crear Admin
                            </a>
                        </li>
      
            
                        <li id="adminDropdownLogout" class="hidden">
                            <a id="logoutButton" class="bg-rose-500 hover:bg-rose-600 text-white py-2 px-4 block whitespace-no-wrap cursor-pointer text-sm">
                         
     
    Cerrar Sesi√≥n
                            </a>
                        </li>

                        <li class="p-2 border-t border-gray-600 text-xs text-gray-400">
          
     
                          <p id="userIdDisplay">Tu ID de usuario: ...</p>
                        </li>
                    </ul>
                </div>
     
        </div>
        </div>
 
    </header>


    <div class="container mx-auto p-4 md:p-8">
        
        <div id="welcomeMessage" class="text-center mt-4 mb-8 text-xl text-blue-300 font-semibold hidden transition-colors duration-300"></div>

        <div id="adminLoginModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300">
            <div class="bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-600 max-w-md w-full relative text-gray-100">
     
            <button id="closeAdminModalButton" 
class="absolute top-3 right-3 text-gray-400 hover:text-white">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>

                <div id="adminLoginContainer">
              
              <h2 class="text-2xl font-bold mb-4 text-gray-100 
text-center">Inicio de Sesi√≥n (Admin)</h2>
                    <p class="text-sm text-gray-400 text-center mb-4">Ingresa con tu email y contrase√±a de administrador.</p>
                    <form id="loginForm">
                        <div class="mb-4">
         
          
                      <label for="loginEmail" class="block text-sm font-medium text-gray-300 mb-1">Email:</label>
                            <input type="email" id="loginEmail" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
                        </div>
 
                    
     <div class="mb-4">
                            <label for="loginPassword" class="block text-sm font-medium text-gray-300 mb-1">Contrase√±a:</label>
                            <input type="password" id="loginPassword" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
   
                   
    </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">
                            Ingresar
           
              </button>
      
                    </form>
                    <p id="loginMessage" class="mt-4 text-center text-sm"></p>
                </div>

                <div id="createAdminContainer" class="hidden">
   
                  <h2 class="text-2xl font-bold mb-4 text-gray-100 text-center">Crear Nuevo 
Usuario Administrador</h2>
                    <p class="text-sm text-gray-400 mb-4">Crea una nueva cuenta de Auth y asigna permisos de administrador en Firestore.</p>
                    <form id="createAdminForm">
                   
      <div class="mb-4">
                 
                       <label for="newAdminEmail" class="block text-sm font-medium text-gray-300 mb-1">Email del Administrador:</label>
                            <input type="email" id="newAdminEmail" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
        
                 </div>
                 
                <div class="mb-4">
                            <label for="newAdminPassword" class="block text-sm font-medium text-gray-300 mb-1">Contrase√±a (M√≠nimo 6 caracteres):</label>
             
                <input type="password" id="newAdminPassword" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
               
                      </div>
                        <div class="mb-4">
             
                <label for="newAdminUsername" class="block text-sm font-medium text-gray-300 mb-1">Nombre de Usuario (Para logs):</label>
                           
                          <input type="text" id="newAdminUsername" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
            
             </div>
                        <div class="mb-4">
                            <label for="secretKey" class="block text-sm font-medium text-gray-300 mb-1">Clave de Promoci√≥n (Opcional, 
para usuarios existentes):</label>
                       
      <input type="password" id="secretKey" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100">
                        </div>
                        <button type="submit" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 
focus:ring-sky-500 focus:ring-offset-2 transition duration-200">
                       
      Crear y Promover Administrador
                        </button>
                        <p id="adminMessage" class="mt-4 text-center text-sm"></p>
              
                   </form>
       
          </div>
            </div>
        </div>
        <div>
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
                <section class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 lg:col-span-1 h-fit text-gray-100">
     
                
    <h2 class="text-2xl font-bold mb-4 text-gray-100">Generar C√≥digo SQL</h2>
                    <div class="mb-4">
                        <label for="descriptionSearch" class="block text-sm font-medium text-gray-300 mb-1">Describe tu necesidad:</label>
                        
 <textarea id="descriptionSearch" rows="3" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-100" placeholder="Ej: 
Obtener el promedio de ventas de productos por categor√≠a en el √∫ltimo mes.">devuelve datos de una tabla</textarea>
                    </div>
                    <button id="descriptionSearchButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">
               
              
          Generar Consulta SQL ‚ú®
                    </button>
                    <div id="recommendationResults" class="mt-4"></div>
                    
                    <h3 class="text-xl font-bold mt-8 mb-2 text-gray-100 
">Comandos 
R√°pidos (Clic para usar)</h3> 
                    <ul id="searchFunctionsList" class="p-2 rounded-lg max-h-48 overflow-y-auto border border-gray-600 bg-gray-700">
                        <p class="text-center text-gray-400 text-sm py-2">Cargando sugerencias...</p>
                    </ul>
               
  </section>

  
               <section class="lg:col-span-2">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 mb-8 text-gray-100">
                        <h2 class="text-2xl font-bold mb-4 text-gray-100">Listado de Comandos SQL</h2> 
                  
       
                       <div class="mb-4">
                            <label for="functionSearchInput" class="block text-sm font-medium text-gray-300 mb-1">Buscar comandos:</label>
                            <input type="text" id="functionSearchInput" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md focus:ring-sky-500 focus:border-sky-500 text-gray-100" placeholder="Ej: SELECT, ADD, AVG, cadena">
     
        
                      </div>
                        <div id="functionsList">
                            <p class="text-center text-gray-400">Cargando comandos...</p>
               
          </div>
       
                      </div>
                </section>
            </main>
            
            <section id="notificationsSection" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 mb-8 hidden 
text-gray-100">
                <h2 class="text-2xl font-bold mb-4 text-gray-100">Notificaciones del 
Administrador</h2>
                <div id="notificationsList" class="max-h-64 overflow-y-auto p-3 rounded-lg border border-blue-700 bg-gray-700">
                    <p class="text-center text-gray-400 text-sm py-2">Esta funcionalidad est√° deshabilitada en la interfaz.\nLa actividad se registra en Firestore Logs.</p>
                </div>
  
           </section>
            
            <section id="fixErrorSection" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 mb-8 hidden text-gray-100">
                <h2 class="text-2xl font-bold mb-4 text-gray-100">Corregir y Optimizar SQL con IA</h2>
   
              <div class="mb-4">
             
               <label for="errorInput" class="block text-sm font-medium text-gray-300 mb-1">Ingresa el c√≥digo SQL con errores o para optimizar:</label>
                    <textarea id="errorInput" rows="4" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md font-mono focus:ring-sky-500 focus:border-sky-500 text-gray-100" placeholder="Ej: SELECT nombre FROM usuarios WHERE edad > 25"></textarea>
         
              </div>
               
  <div class="mb-4">
                    <label for="correctionKey" class="block text-sm font-medium text-gray-300 mb-1">Clave de Promoci√≥n (DT10VazC;#9i):</label>
                    <input type="password" id="correctionKey" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md focus:ring-sky-500 focus:border-sky-500 text-gray-100">
              
               </div>
         
               <button id="fixButton" type="button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition duration-200">
                        Corregir Sintaxis ‚ú®
                    </button>
                    
 <div id="correctionResult"></div>
         
        </section>

            <section id="addFunctionSection" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 mt-8 hidden text-gray-100">
                <h2 class="text-2xl font-bold mb-4 text-gray-100">Agregar Nuevo Comando/Concepto</h2> 
                <form id="addFunctionForm">
                 
              
                   <div class="mb-4">
                        <label for="funcName" class="block text-sm font-medium text-gray-300 mb-1">Nombre del Comando/Concepto (Ej: SELECT, UPDATE, AVG, DDL):</label> 
                        <input type="text" id="funcName" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required>
                    </div>
  
 
                      <div class="mb-4">
                        <label for="funcDescription" class="block text-sm font-medium text-gray-300 mb-1">Descripci√≥n breve:</label>
                        <textarea id="funcDescription" rows="3" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" required></textarea>
            
   
               </div>
                    <div class="mb-4">
                        <label for="funcSyntax" class="block text-sm font-medium text-gray-300 mb-1">Sintaxis (Ej.\nSELECT * FROM tabla;):</label>
                        <textarea id="funcSyntax" rows="3" class="w-full 
p-2 border border-gray-600 bg-gray-700 rounded-md font-mono text-gray-100" required></textarea>
                    </div>
                    
                    <button 
id="validateSyntaxButton" type="button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 transition duration-200 mb-3">
                
          Pre-validar Sintaxis con IA ‚ú®
                    </button>
                    <div id="validationMessage" class="mt-4 text-center"></div>
             
                       <button id="addFunctionButton" type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 
px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition duration-200">
                        Guardar Comando
                    </button>
                </form>
                
 <div id="statusMessage" class="mt-4 text-center"></div>
            
 </section>
            
            <section id="bulkAddSection" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-600 mt-8 hidden text-gray-100">
                <h2 class="text-2xl font-bold mb-4 text-gray-100">A√±adir M√∫ltiples Comandos con IA</h2> 
                <p class="text-sm text-gray-400 mb-4">Pega una lista simple de conceptos SQL (uno por l√≠nea o separados por comas).
La IA los generar√°, estructurar√° y guardar√° autom√°ticamente.</p>
                <form id="bulkAddForm">
                    <div class="mb-4">
                        <label for="bulkInput" class="block text-sm font-medium text-gray-300 mb-1">Lista de Comandos/Conceptos:</label> 
                      
                      <textarea id="bulkInput" rows="5" class="w-full p-2 border border-gray-600 bg-gray-700 rounded-md text-gray-100" placeholder="Ej: INNER JOIN, GROUP BY, Funci√≥n AVG, Crear tabla de usuarios."></textarea>
                    </div>
                    
                    <button id="bulkAddButton" type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">
  
                       A√±adir Comandos Masivamente con IA üöÄ
                    </button>
                    <div id="bulkResult" class="mt-4 text-center"></div>
                </form>
            </section>
  
           
            </div>
    </div>

        <div id="confirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100 text-gray-100">
            <h3 class="text-xl font-bold text-gray-100 mb-4">Confirmaci√≥n Requerida</h3>
            <p id="confirmModalMessage" class="text-gray-300 mb-6">¬øEst√°s seguro de que 
quieres realizar esta acci√≥n?</p>
      
               <div class="flex justify-end space-x-3">
                <button id="cancelBtn" class="bg-gray-600 hover:bg-gray-500 text-gray-100 font-bold py-2 px-4 rounded-lg transition duration-200">
                    Cancelar
                </button>
           
               <button id="confirmBtn" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg transition 
duration-200">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

</body>
</html>
