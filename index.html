<!DOCTYPE html>
<html lang="es"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Código Grabado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para el menú desplegable */
        .dropdown:hover .dropdown-menu { display: block; }
        /* Estilos base del toggle */
        .theme-toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .theme-toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4f46e5; }
        input:checked + .slider:before { transform: translateX(22px); }
        /* No se necesita CSS adicional para .code-container */
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, getDocs, setDoc, getDoc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Config Firebase (sin cambios)
        const firebaseConfig = {
            apiKey: "AIzaSyCeD4TAPK2GuW01J5WQl7vJjmJWC671f-Y",
            authDomain: "codigograbado.firebaseapp.com",
            projectId: "codigograbado",
            storageBucket: "codigograbado.firebasestorage.app",
            messagingSenderId: "346430888474",
            appId: "1:346430888474:web:cbaa641fbf4fc62bca4fa3",
            measurementId: "G-626THBS8CJ"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId, loggedInUser = null;
        let functionsList = [];
        let editingId = null;
        let confirmActionCallback = null;
        let isSyntaxValid = false;
        const SUPER_ADMIN_KEY = 'DT10VazC;#9i';
        const DB_ROOT = `/artifacts/public/data/aTvZxvxzBtCnCNlURVrQ`;
        const FUNCTIONS_PATH = `${DB_ROOT}/sql_functions`;
        const ADMINS_PATH = `${DB_ROOT}/admins`;
        const LOGS_PATH = `${DB_ROOT}/logs`;
        const NOTIFICATIONS_PATH = `${DB_ROOT}/notifications`;

        // ************************************************************
        // ********* FUNCIÓN DE MANEJO DE TEMAS (CORREGIDA) ***********
        // ************************************************************
        const initializeTheme = () => {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            let isDark = localStorage.getItem('darkMode') === 'true';

            if (localStorage.getItem('darkMode') === null) {
                isDark = prefersDark;
            }

            // Aplicar la clase 'dark' al elemento <html>
            if (isDark) {
                document.documentElement.classList.add('dark');
                if (document.getElementById('darkModeToggle')) {
                   document.getElementById('darkModeToggle').checked = true;
                }
            } else {
                document.documentElement.classList.remove('dark');
                 if (document.getElementById('darkModeToggle')) {
                   document.getElementById('darkModeToggle').checked = false;
                }
            }
            // No se necesita applyTailwindClasses
        };

        const toggleDarkMode = () => {
            // Alternar la clase 'dark' en el elemento <html>
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
            // No se necesita applyTailwindClasses
        };
        // ************************************************************

        // --- Funciones del Modal de Confirmación --- (Sin cambios)
        const showConfirmModal = (message, onConfirm) => { document.getElementById('confirmModalMessage').textContent = message; document.getElementById('confirmModal').classList.remove('hidden'); document.getElementById('confirmModal').classList.add('flex'); confirmActionCallback = onConfirm; };
        const hideConfirmModal = () => { document.getElementById('confirmModal').classList.add('hidden'); document.getElementById('confirmModal').classList.remove('flex'); confirmActionCallback = null; };
        const handleConfirm = (isConfirmed) => { if (isConfirmed && confirmActionCallback) { confirmActionCallback(); } hideConfirmModal(); };

        // Función para inicializar Firebase (Sin cambios)
        const initFirebase = async () => { try { const app = initializeApp(firebaseConfig); db = getFirestore(app); auth = getAuth(app); if (initialAuthToken) { await signInWithCustomToken(auth, initialAuthToken); } else { await signInAnonymously(auth); } userId = auth.currentUser.uid; document.getElementById('userIdDisplay').textContent = `Tu ID de usuario: ${userId}`; console.log("Firebase inicializado y autenticación exitosa."); fetchFunctions(); } catch (error) { console.error("Error al inicializar Firebase o autenticar:", error); showMessage("Error: No se pudo conectar a la base de datos.", 'error'); } };

        // Función showMessage (Sin cambios en lógica)
        const showMessage = (message, type = 'info') => { const validationDiv = document.getElementById('validationMessage') || document.getElementById('recommendationResults') || document.createElement('div'); if (!validationDiv) return; validationDiv.innerHTML = `<p class="mt-4 text-center p-3 rounded-lg font-medium" id="tempStatusMessage">${message}</p>`; const tempStatusMessage = validationDiv.querySelector('#tempStatusMessage'); if (!tempStatusMessage) return; tempStatusMessage.className = 'mt-4 text-center p-3 rounded-lg font-medium'; if (type === 'error') { tempStatusMessage.classList.add('bg-rose-200', 'text-rose-800'); } else if (type === 'success') { tempStatusMessage.classList.add('bg-emerald-200', 'text-emerald-800'); } else { tempStatusMessage.classList.add('bg-indigo-200', 'text-indigo-800'); } setTimeout(() => { validationDiv.innerHTML = ''; }, 5000); };

        // Funciones fetchFunctions, fetchNotifications, addNotification, deleteNotification, displayNotifications (Sin cambios)
        const fetchFunctions = () => { if (!db) return; const q = collection(db, FUNCTIONS_PATH); onSnapshot(q, (snapshot) => { functionsList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); displayFunctions(); }, (error) => { console.error("Error al obtener comandos:", error); showMessage("Error al cargar los comandos.", 'error'); }); };
        const fetchNotifications = () => { console.log("Carga de notificaciones deshabilitada en la interfaz."); return; };
        const addNotification = async (func) => {};
        const deleteNotification = async (functionName) => {};
        const displayNotifications = (notifications) => { const el = document.getElementById('notificationsList'); if (el) el.innerHTML = '<p>...</p>'; };


        // ************************************************************
        // ********* displayFunctions CON CLASES DARK: MEJORADAS ******
        // ************************************************************
        const displayFunctions = (functionsToDisplay = functionsList) => {
            const listElement = document.getElementById('functionsList');
            const searchList = document.getElementById('searchFunctionsList');
            listElement.innerHTML = '';
            searchList.innerHTML = '';

            const isUserLoggedIn = loggedInUser !== null;

            if (functionsToDisplay.length === 0) {
                listElement.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No se encontraron comandos.</p>';
                searchList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 text-sm py-2">No hay sugerencias.</p>';
                return;
            }

            functionsToDisplay.forEach(func => {
                const funcItem = document.createElement('div');
                // Clases base y dark: para la card del comando
                funcItem.className = 'p-4 rounded-lg shadow-md mb-4 bg-gray-200 dark:bg-gray-600';

                funcItem.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">${func.name}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-2"><strong>Descripción:</strong> ${func.description}</p>
                    <div class="code-container p-3 rounded-lg border border-gray-400 dark:border-gray-500 overflow-x-auto bg-white dark:bg-gray-700">
                        <pre class="whitespace-pre-wrap font-mono text-gray-800 dark:text-gray-200"><code>${func.syntax}</code></pre>
                    </div>
                    <div class="mt-4 flex space-x-2 ${isUserLoggedIn ? '' : 'hidden'}">
                        <button class="edit-btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-sm" data-id="${func.id}">Editar</button>
                        <button class="delete-btn bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-sm" data-id="${func.id}">Eliminar</button>
                    </div>
                `;
                listElement.appendChild(funcItem);

                if (isUserLoggedIn) {
                    funcItem.querySelector('.edit-btn').addEventListener('click', () => editFunction(func));
                    funcItem.querySelector('.delete-btn').addEventListener('click', () => deleteFunction(func.id));
                }

                const searchItem = document.createElement('li');
                // Clases base y dark: para la lista de sugerencias
                searchItem.className = 'hover:bg-gray-300 dark:hover:bg-gray-500 cursor-pointer p-2 rounded-md transition duration-150 text-gray-800 dark:text-gray-200';
                searchItem.textContent = func.name;
                searchItem.onclick = () => {
                    document.getElementById('descriptionSearch').value = func.description;
                    document.getElementById('descriptionSearch').focus();
                    showMessage(`Descripción del comando "${func.name}" cargada en el generador de consultas.`, 'info');
                };
                searchList.appendChild(searchItem);
            });
        };

        // Función validateFunctionWithAI (Sin cambios lógicos)
        const validateFunctionWithAI = async () => { const name = document.getElementById('funcName').value.trim(); const description = document.getElementById('funcDescription').value.trim(); const syntax = document.getElementById('funcSyntax').value.trim(); const validationMessageDiv = document.getElementById('validationMessage'); const validateButton = document.getElementById('validateSyntaxButton'); if (!loggedInUser) { validationMessageDiv.innerHTML = `<p>Debes iniciar sesión...</p>`; return; } if (!name || !description || !syntax) { validationMessageDiv.innerHTML = `<p>Completa los campos...</p>`; return; } validateButton.textContent = 'Validando...'; validateButton.disabled = true; validationMessageDiv.innerHTML = `<p>Analizando...</p>`; isSyntaxValid = false; const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q"; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; let prompt = `Eres un experto en SQL... Evalúa si la 'Sintaxis proporcionada' es un comando SQL bien formado... - Si la Sintaxis es un comando SQL válido, responde con: SI:VALIDA - Si NO es válido... Responde con: NO:Sugerencia de Comando: [Comando/Corrección sugerida] Comando/Concepto Intendado: "${name}" Descripción: "${description}" Sintaxis proporcionada: "${syntax}"`; const payload = { contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: "Responde estrictamente con 'SI:VALIDA' o 'NO:Sugerencia de Comando: [COMANDO SUGERIDO/CORRECCIÓN]'..." }] }, }; let attempts = 0; const maxAttempts = 3; const initialDelay = 1000; const makeApiCall = async () => { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (response.status === 429 && attempts < maxAttempts - 1) { throw new Error("Rate limit exceeded"); } return response; }; try { let response; while (attempts < maxAttempts) { try { response = await makeApiCall(); break; } catch (error) { if (error.message === "Rate limit exceeded") { const delay = initialDelay * Math.pow(2, attempts); await new Promise(resolve => setTimeout(resolve, delay)); attempts++; } else { throw error; } } } const result = await response.json(); const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || ''; const responseText = text.trim().toUpperCase(); if (responseText.startsWith('SI:VALIDA')) { isSyntaxValid = true; validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-emerald-800 bg-emerald-200 p-3 rounded-lg">¡Validación exitosa!...</p>`; return { valid: true }; } else if (responseText.startsWith('NO:SUGERENCIA DE COMANDO:')) { const suggestion = responseText.replace('NO:SUGERENCIA DE COMANDO:', '').trim(); const userMessage = `Error de Sintaxis: ... Sugerencia: **${suggestion}**...`; validationMessageDiv.innerHTML = `<p class="mt-2 text-center text-rose-800 bg-rose-200 p-3 rounded-lg">${userMessage}</p>`; return { valid: false }; } else { validationMessageDiv.innerHTML = `<p>Error: La sintaxis no es válida...</p>`; return { valid: false }; } } catch (error) { console.error("Error al validar con IA:", error); validationMessageDiv.innerHTML = `<p>Error de conexión...</p>`; return { valid: false }; } finally { validateButton.textContent = 'Pre-validar Sintaxis con IA ✨'; validateButton.disabled = false; } };

        // Función generateSQLQuery (CORREGIDA PARA TEMA OSCURO EN RESULTADOS)
        const generateSQLQuery = async () => { const description = document.getElementById('descriptionSearch').value.trim(); const button = document.getElementById('descriptionSearchButton'); const resultsDiv = document.getElementById('recommendationResults'); if (!description) { resultsDiv.innerHTML = `<p>Por favor, describe...</p>`; return; } button.textContent = 'Generando...'; button.disabled = true; resultsDiv.innerHTML = `<p>Generando consulta...</p>`; const apiKey = "AIzaSyBUjsv2ZW2vRjLuD2pAwVtgurMdTkXCO4Q"; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; const prompt = `Eres un experto en SQL... Genera una consulta SQL (solo el código)... Descripción: "${description}".`; const payload = { contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: "Genera exclusivamente código SQL..." }] }, }; try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) { throw new Error(`Error en la API: ${response.statusText}`); } const result = await response.json(); const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || ''; const sqlCode = text.replace(/```sql|```/g, '').trim(); resultsDiv.innerHTML = `<h3 class="text-xl font-bold mt-4 mb-2 text-gray-900 dark:text-gray-100">Consulta Generada:</h3><div class="code-container p-3 rounded-lg border border-gray-400 dark:border-gray-600 overflow-x-auto bg-white dark:bg-gray-700"><pre class="whitespace-pre-wrap font-mono text-gray-800 dark:text-gray-200"><code>${sqlCode}</code></pre></div>`; } catch (error) { console.error("Error al generar la consulta SQL:", error); resultsDiv.innerHTML = `<p>Error al generar la consulta...</p>`; } finally { button.textContent = 'Generar Consulta SQL ✨'; button.disabled = false; } };

        // Funciones addOrUpdateFunction, editFunction, deleteFunction, createAdmin, logout, login, sendWelcomeMessage, fixSyntaxWithAI, searchFunctions (Sin cambios lógicos)
        const addOrUpdateFunction = async (event) => { /* ... (código existente sin cambios lógicos) ... */ };
        const editFunction = (func) => { /* ... (código existente sin cambios lógicos) ... */ };
        const deleteFunction = async (id) => { /* ... (código existente sin cambios lógicos) ... */ };
        const createAdmin = async (event) => { /* ... (código existente sin cambios lógicos) ... */ };
        const logout = async () => { /* ... (código existente sin cambios lógicos) ... */ };
        const login = async (event) => { /* ... (código existente sin cambios lógicos) ... */ };
        const sendWelcomeMessage = async (lastLogin, username) => { /* ... (código existente sin cambios lógicos) ... */ };
        const fixSyntaxWithAI = async () => { /* ... (código existente sin cambios lógicos) ... */ };
        const searchFunctions = (event) => { /* ... (código existente sin cambios lógicos) ... */ };

        // Funciones para el modal de admin (Sin cambios)
        const showAdminLogin = () => { document.getElementById('adminLoginModal').classList.remove('hidden'); document.getElementById('adminLoginModal').classList.add('flex'); document.getElementById('adminLoginContainer').classList.remove('hidden'); document.getElementById('createAdminContainer').classList.add('hidden'); };
        const showAdminManagement = () => { document.getElementById('adminLoginModal').classList.remove('hidden'); document.getElementById('adminLoginModal').classList.add('flex'); document.getElementById('adminLoginContainer').classList.add('hidden'); document.getElementById('createAdminContainer').classList.remove('hidden'); };
        const closeAdminModal = () => { document.getElementById('adminLoginModal').classList.add('hidden'); document.getElementById('adminLoginModal').classList.remove('flex'); };

        // Event Listeners (Sin cambios lógicos, initializeTheme al inicio)
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme(); // Inicializa el tema al cargar
            initFirebase();
            
            document.getElementById('showLoginButton').addEventListener('click', showAdminLogin);
            document.getElementById('logoutButton').addEventListener('click', logout);
            document.getElementById('showAdminManagementButton').addEventListener('click', showAdminManagement);
            document.getElementById('closeAdminModalButton').addEventListener('click', closeAdminModal);
            document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);

            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('addFunctionForm').addEventListener('submit', addOrUpdateFunction);
            document.getElementById('validateSyntaxButton').addEventListener('click', validateFunctionWithAI);
            document.getElementById('descriptionSearchButton').addEventListener('click', generateSQLQuery);
            document.getElementById('fixButton').addEventListener('click', fixSyntaxWithAI);
            document.getElementById('createAdminForm').addEventListener('submit', createAdmin);
            document.getElementById('functionSearchInput').addEventListener('input', searchFunctions);
            document.getElementById('confirmBtn').addEventListener('click', () => handleConfirm(true));
            document.getElementById('cancelBtn').addEventListener('click', () => handleConfirm(false));

            const resetValidation = () => { isSyntaxValid = false; document.getElementById('validationMessage').innerHTML = ''; document.getElementById('statusMessage').innerHTML = ''; };
            document.getElementById('funcName').addEventListener('input', resetValidation);
            document.getElementById('funcDescription').addEventListener('input', resetValidation);
            document.getElementById('funcSyntax').addEventListener('input', resetValidation);
        });
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-800 font-sans leading-normal tracking-normal text-gray-800 dark:text-gray-100 transition-colors duration-300">

    <header class="bg-white shadow-md sticky top-0 z-10 dark:bg-gray-700 transition-colors duration-300">
        <div class="container mx-auto px-4 md:px-8 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-extrabold text-gray-900 dark:text-gray-100">Código Grabado</h1>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <span class="text-gray-600 dark:text-gray-300 text-sm">Claro</span>
                    <label class="theme-toggle-switch"><input type="checkbox" id="darkModeToggle"><span class="slider"></span></label>
                    <span class="text-gray-600 dark:text-gray-300 text-sm">Oscuro</span>
                </div>
                <div class="dropdown inline-block relative">
                    <button class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded inline-flex items-center hover:bg-indigo-700 transition duration-200">
                        <span class="mr-1">Admin</span>
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </button>
                    <ul class="dropdown-menu absolute hidden text-gray-700 pt-1 right-0 z-20 w-64 shadow-xl border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg overflow-hidden transition-colors duration-300">
                        <li id="adminDropdownLogin"><a id="showLoginButton" class="bg-indigo-500 hover:bg-indigo-600 text-white py-2 px-4 block whitespace-no-wrap cursor-pointer text-sm">Iniciar Sesión</a></li>
                        <li id="adminDropdownManagement" class="hidden"><a id="showAdminManagementButton" class="bg-purple-100 hover:bg-purple-200 dark:bg-purple-800 dark:text-gray-100 dark:hover:bg-purple-900 py-2 px-4 block whitespace-no-wrap cursor-pointer text-sm font-medium transition-colors duration-300">Crear Admin</a></li>
                        <li id="adminDropdownLogout" class="hidden"><a id="logoutButton" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 block whitespace-no-wrap cursor-pointer text-sm">Cerrar Sesión</a></li>
                        <li class="p-2 border-t dark:border-gray-600 text-xs text-gray-500 dark:text-gray-400"><p id="userIdDisplay">Tu ID de usuario: ...</p></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto p-4 md:p-8">
        <div id="welcomeMessage" class="text-center mt-4 mb-8 text-xl text-indigo-800 dark:text-indigo-300 font-semibold hidden transition-colors duration-300"></div>

        <div id="adminLoginModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300">
            <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 max-w-md w-full relative dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 transition-colors duration-300">
                <button id="closeAdminModalButton" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-100">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
                <div id="adminLoginContainer">
                     <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100 text-center">Inicio de Sesión (Admin)</h2>
                     <p class="text-sm text-gray-500 dark:text-gray-400 text-center mb-4">Ingresa con tu email y contraseña.</p>
                     <form id="loginForm">
                         <div class="mb-4"><label for="loginEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email:</label><input type="email" id="loginEmail" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-600 dark:text-gray-100" required></div>
                         <div class="mb-4"><label for="loginPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Contraseña:</label><input type="password" id="loginPassword" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-600 dark:text-gray-100" required></div>
                         <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Ingresar</button>
                     </form>
                     <p id="loginMessage" class="mt-4 text-center text-sm"></p>
                </div>
                <div id="createAdminContainer" class="hidden">
                     <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100 text-center">Crear Nuevo Admin</h2>
                     <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Crea una cuenta y asigna permisos.</p>
                     <form id="createAdminForm">
                         <div class="mb-4"><label for="newAdminEmail" class="block text-sm font-medium dark:text-gray-300">Email:</label><input type="email" id="newAdminEmail" class="w-full p-2 border dark:border-gray-600 rounded dark:bg-gray-600 dark:text-gray-100" required></div>
                         <div class="mb-4"><label for="newAdminPassword" class="block text-sm font-medium dark:text-gray-300">Contraseña:</label><input type="password" id="newAdminPassword" class="w-full p-2 border dark:border-gray-600 rounded dark:bg-gray-600 dark:text-gray-100" required></div>
                         <div class="mb-4"><label for="newAdminUsername" class="block text-sm font-medium dark:text-gray-300">Nombre Usuario:</label><input type="text" id="newAdminUsername" class="w-full p-2 border dark:border-gray-600 rounded dark:bg-gray-600 dark:text-gray-100" required></div>
                         <div class="mb-4"><label for="secretKey" class="block text-sm font-medium dark:text-gray-300">Clave Promoción:</label><input type="password" id="secretKey" class="w-full p-2 border dark:border-gray-600 rounded dark:bg-gray-600 dark:text-gray-100"></div>
                         <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">Crear Admin</button>
                         <p id="adminMessage" class="mt-4 text-center text-sm"></p>
                     </form>
                </div>
            </div>
        </div>

        <div>
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 lg:col-span-1 h-fit dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Generar Código SQL</h2>
                    <div class="mb-4">
                        <label for="descriptionSearch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Describe tu necesidad:</label>
                        <textarea id="descriptionSearch" rows="3" class="w-full p-2 border border-gray-400 dark:border-gray-600 rounded-md focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-600 dark:text-gray-100" placeholder="Ej: Obtener el promedio...">devuelve datos de una tabla</textarea>
                    </div>
                    <button id="descriptionSearchButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Generar Consulta SQL ✨</button>
                    <div id="recommendationResults" class="mt-4"></div>
                    <h3 class="text-xl font-bold mt-8 mb-2 text-gray-900 dark:text-gray-100">Comandos Rápidos</h3>
                    <ul id="searchFunctionsList" class="p-2 rounded-lg max-h-48 overflow-y-auto border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-600">
                        <p class="text-center text-gray-500 dark:text-gray-400 text-sm py-2">Cargando...</p>
                    </ul>
                </section>

                <section class="lg:col-span-2">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8 dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300">
                        <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100">Listado de Comandos SQL</h2>
                        <div class="mb-4">
                            <label for="functionSearchInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Buscar comandos:</label>
                            <input type="text" id="functionSearchInput" class="w-full p-2 border border-gray-400 dark:border-gray-600 rounded-md dark:bg-gray-600 dark:text-gray-100" placeholder="Ej: SELECT, ADD...">
                        </div>
                        <div id="functionsList"><p class="text-center text-gray-500 dark:text-gray-400">Cargando...</p></div>
                    </div>
                </section>
            </main>

            <section id="notificationsSection" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8 hidden dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300"> /* ... */ </section>
            <section id="fixErrorSection" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8 hidden dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300"> /* ... */ </section>
            <section id="addFunctionSection" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mt-8 hidden dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300"> /* ... */ </section>
            <section id="adminManagementSection" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mt-8 mb-8 hidden dark:bg-gray-700 dark:border-gray-600 transition-colors duration-300"> /* ... */ </section>
        </div>
    </div>

    <div id="confirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full dark:bg-gray-700 dark:text-gray-100">
            <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-4">Confirmación</h3>
            <p id="confirmModalMessage" class="text-gray-700 dark:text-gray-300 mb-6">¿Estás seguro?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-gray-200">Cancelar</button>
                <button id="confirmBtn" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded">Confirmar</button>
            </div>
        </div>
    </div>

</body>
</html>
